import fetch from 'node-fetch';

const handler = async (m, { conn, mentioned, sender }) => {
    try {
        let targetUser;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø°ÙƒÙˆØ±
        if (mentioned && mentioned.length > 0) {
            targetUser = mentioned[0];
        } 
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ ØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§
        else if (m.message?.extendedTextMessage?.contextInfo?.participant) {
            targetUser = m.message.extendedTextMessage.contextInfo.participant;
        }
        
        if (!targetUser) {
            return await conn.sendMessage(m.chat, {
                text: `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Œ ÙŠØ±Ø¬Ù‰ Ø°ÙƒØ± Ø´Ø®Øµ Ø£Ùˆ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„ØªÙ‡ Ù„Ù„Ù…ØºØ§Ø²Ù„Ø©

ğŸ“ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:
â”œâ”€ .flirt @user
â”œâ”€ Ø£Ùˆ Ø£Ø±Ø³Ù„ .flirt Ù…Ø¹ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø©
â””â”€ ÙƒÙ† Ù…Ø­ØªØ±Ù…Ø§Ù‹ ÙˆÙ„Ø§ ØªØ³ÙŠØ¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø©!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ Ù…Ø«Ø§Ù„: .flirt @username`,
                mentions: [sender]
            }, { quoted: m });
        }

        // Ù…Ù†Ø¹ Ø§Ù„Ù…ØºØ§Ø²Ù„Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©
        if (targetUser === sender) {
            return await conn.sendMessage(m.chat, {
                text: `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø°Ù„Ùƒ        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ù…ØºØ§Ø²Ù„Ø© Ù†ÙØ³Ùƒ!

ğŸ’¡ Ø­Ø§ÙˆÙ„:
â”œâ”€ Ø°ÙƒØ± Ø´Ø®Øµ Ø¢Ø®Ø±
â”œâ”€ Ø£Ùˆ Ø§Ø·Ù„Ø¨ Ù…Ù† ØµØ¯ÙŠÙ‚ Ù…ØºØ§Ø²Ù„ØªÙƒ
â””â”€ Ø§Ù„Ø­Ø¨ ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø§Ø­ØªØ±Ø§Ù… Ø§Ù„Ø°Ø§Øª!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ Ø¬Ø±Ø¨ Ù…Ø¹ Ø´Ø®Øµ Ø¢Ø®Ø±`,
                mentions: [sender]
            }, { quoted: m });
        }

        // Ù…Ù†Ø¹ Ù…ØºØ§Ø²Ù„Ø© Ø§Ù„Ø¨ÙˆØª
        if (targetUser === conn.user.id) {
            return await conn.sendMessage(m.chat, {
                text: `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ¤– Ø£Ù†Ø§ Ù…Ø¬Ø±Ø¯ Ø¨ÙˆØª       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ Ø£Ù†Ø§ Ù…Ø¬Ø±Ø¯ Ø¨ÙˆØªØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª!

ğŸ’¡ Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ù…ØºØ§Ø²Ù„Ø© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† ğŸ˜Š

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ Ø¬Ø±Ø¨ Ù…Ø¹ Ø´Ø®Øµ Ø­Ù‚ÙŠÙ‚ÙŠ`,
                mentions: [sender]
            }, { quoted: m });
        }

        // Ø±Ø¯ ÙØ¹Ù„
        await conn.sendMessage(m.chat, { 
            react: { text: 'ğŸ’•', key: m.key } 
        });

        // Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¨Ø¯Ø¡
        await conn.sendMessage(m.chat, {
            text: `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ’• Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù: @${targetUser.split('@')[0]}
ğŸ“ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø±Ø³Ø§Ù„Ø© ØºØ±Ø§Ù…ÙŠØ©...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â±ï¸ Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†Ù`,
            mentions: [targetUser]
        }, { quoted: m });

        const apiKey = 'shizo';
        const response = await fetch(`https://shizoapi.onrender.com/api/texts/flirt?apikey=${apiKey}`, {
            timeout: 15000,
            headers: {
                'User-Agent': 'Crimson Bot'
            }
        });

        let flirtMessage;
        
        if (response.ok) {
            const data = await response.json();
            flirtMessage = data.result;
        } else {
            // Ø±Ø³Ø§Ø¦Ù„ Ù…ØºØ§Ø²Ù„Ø© Ø¨Ø¯ÙŠÙ„Ø©
            const backupFlirts = [
                "Ù„Ùˆ ÙƒÙ†Øª Ù†Ø¬Ù…Ø© ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡ØŒ Ù„ÙƒÙ†ØªÙ Ø§Ù„Ø£ÙƒØ«Ø± Ø¥Ø´Ø±Ø§Ù‚Ø§Ù‹ ÙˆØ¬Ù…Ø§Ù„Ø§Ù‹!",
                "Ù‡Ù„ ØªØ¹Ù„Ù… Ø£Ù†ÙƒÙ Ø£Ø¬Ù…Ù„ Ù…Ù† Ù‚ÙˆØ³ Ù‚Ø²Ø­ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø·Ø±ØŸ",
                "Ù„Ùˆ ÙƒØ§Ù† Ù„Ù„Ø­Ø¨ Ø¹Ù†ÙˆØ§Ù†ØŒ Ù„ÙƒÙ†ØªÙ Ø¹Ù†ÙˆØ§Ù†Ù‡ Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø£Ø®ÙŠØ±!",
                "Ø¹ÙŠÙ†Ø§ÙƒÙ ÙƒØ§Ù„Ù†Ø¬ÙˆÙ… ØªØ¶ÙŠØ¦Ø§Ù† Ø¸Ù„Ø§Ù… Ø­ÙŠØ§ØªÙŠ!",
                "Ø£Ù†ØªÙ Ù…Ø«Ù„ Ø§Ù„Ù‚Ù‡ÙˆØ© Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ©ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø¨Ø¯Ø¡ ÙŠÙˆÙ…ÙŠ Ø¨Ø¯ÙˆÙ†Ùƒ!"
            ];
            flirtMessage = backupFlirts[Math.floor(Math.random() * backupFlirts.length)];
        }

        await conn.sendMessage(m.chat, {
            text: `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     ğŸ’• Ø±Ø³Ø§Ù„Ø© ØºØ±Ø§Ù…ÙŠØ©     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ Ù…Ù†: @${sender.split('@')[0]}
ğŸ’Œ Ø¥Ù„Ù‰: @${targetUser.split('@')[0]}
ğŸ’¬ Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${flirtMessage}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¤– Crimson Bot | Ø­Ø¨ ÙˆÙ…Ø´Ø§Ø¹Ø±`,
            mentions: [sender, targetUser]
        }, { quoted: m });

        console.log(`âœ… Flirt message sent from: ${sender} to: ${targetUser}`);

    } catch (error) {
        console.error('âŒ Error in flirt command:', error);
        
        await conn.sendMessage(m.chat, {
            text: `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âŒ ÙØ´Ù„ Ø§Ù„Ù…ØºØ§Ø²Ù„Ø©        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ØºØ§Ø²Ù„Ø©

ğŸ’¡ Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:
â”œâ”€ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
â”œâ”€ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„
â”œâ”€ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
â””â”€ Ø±Ø¨Ù…Ø§ Ø§Ù„ÙˆÙ‚Øª ØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”„ Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰`,
            mentions: [sender]
        }, { quoted: m });
    }
};

handler.help = ['flirt', 'Ù…ØºØ§Ø²Ù„Ø©', 'ØºØ²Ù„'];
handler.tags = ['fun', 'social'];
handler.command = ['flirt', 'Ù…ØºØ§Ø²Ù„Ø©', 'ØºØ²Ù„', 'Ø­Ø¨'];
handler.description = 'Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù…ØºØ§Ø²Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø°ÙƒÙˆØ±';
handler.usage = '.flirt @user';
handler.example = '.flirt @username';

handler.group = true;
handler.private = true;
handler.owner = false;
handler.admin = false;
handler.premium = false;
handler.botAdmin = false;

export default handler;
